import{a as e}from"../shared/ssr-window.esm.min.mjs";import{e as t,a as i,b as a,j as r}from"../shared/utils.min.mjs";function s(s){let{swiper:o,extendParams:n,on:l,emit:m}=s;const c=e();n({zoom:{enabled:!1,limitToOriginalSize:!1,maxRatio:3,minRatio:1,panOnMouseMove:!1,toggle:!0,containerClass:"swiper-zoom-container",zoomedSlideClass:"swiper-slide-zoomed"}}),o.zoom={enabled:!1};let d,u,p=1,g=!1,h=!1,E={x:0,y:0};const v=[],f={originX:0,originY:0,slideEl:void 0,slideWidth:void 0,slideHeight:void 0,imageEl:void 0,imageWrapEl:void 0,maxRatio:3},x={isTouched:void 0,isMoved:void 0,currentX:void 0,currentY:void 0,minX:void 0,minY:void 0,maxX:void 0,maxY:void 0,width:void 0,height:void 0,startX:void 0,startY:void 0,touchesStart:{},touchesCurrent:{}},X={x:void 0,y:void 0,prevPositionX:void 0,prevPositionY:void 0,prevTime:void 0};let Y,y=1;function M(){if(v.length<2)return 1;const e=v[0].pageX,t=v[0].pageY,i=v[1].pageX,a=v[1].pageY;return Math.sqrt((i-e)**2+(a-t)**2)}function z(){const e=o.params.zoom,t=f.imageWrapEl.getAttribute("data-swiper-zoom")||e.maxRatio;if(e.limitToOriginalSize&&f.imageEl&&f.imageEl.naturalWidth){const e=f.imageEl.naturalWidth/f.imageEl.offsetWidth;return Math.min(e,t)}return t}function C(e){const t=o.isElement?"swiper-slide":`.${o.params.slideClass}`;return!!e.target.matches(t)||o.slides.filter((t=>t.contains(e.target))).length>0}function W(e){const t=`.${o.params.zoom.containerClass}`;return!!e.target.matches(t)||[...o.hostEl.querySelectorAll(t)].filter((t=>t.contains(e.target))).length>0}function w(e){if("mouse"===e.pointerType&&v.splice(0,v.length),!C(e))return;const t=o.params.zoom;if(d=!1,u=!1,v.push(e),!(v.length<2)){if(d=!0,f.scaleStart=M(),!f.slideEl){f.slideEl=e.target.closest(`.${o.params.slideClass}, swiper-slide`),f.slideEl||(f.slideEl=o.slides[o.activeIndex]);let a=f.slideEl.querySelector(`.${t.containerClass}`);if(a&&(a=a.querySelectorAll("picture, img, svg, canvas, .swiper-zoom-target")[0]),f.imageEl=a,f.imageWrapEl=a?i(f.imageEl,`.${t.containerClass}`)[0]:void 0,!f.imageWrapEl)return void(f.imageEl=void 0);f.maxRatio=z()}if(f.imageEl){const[e,t]=function(){if(v.length<2)return{x:null,y:null};const e=f.imageEl.getBoundingClientRect();return[(v[0].pageX+(v[1].pageX-v[0].pageX)/2-e.x-c.scrollX)/p,(v[0].pageY+(v[1].pageY-v[0].pageY)/2-e.y-c.scrollY)/p]}();f.originX=e,f.originY=t,f.imageEl.style.transitionDuration="0ms"}g=!0}}function S(e){if(!C(e))return;const t=o.params.zoom,i=o.zoom,a=v.findIndex((t=>t.pointerId===e.pointerId));a>=0&&(v[a]=e),v.length<2||(u=!0,f.scaleMove=M(),f.imageEl&&(i.scale=f.scaleMove/f.scaleStart*p,i.scale>f.maxRatio&&(i.scale=f.maxRatio-1+(i.scale-f.maxRatio+1)**.5),i.scale<t.minRatio&&(i.scale=t.minRatio+1-(t.minRatio-i.scale+1)**.5),f.imageEl.style.transform=`translate3d(0,0,0) scale(${i.scale})`))}function b(e){if(!C(e))return;if("mouse"===e.pointerType&&"pointerout"===e.type)return;const t=o.params.zoom,i=o.zoom,a=v.findIndex((t=>t.pointerId===e.pointerId));a>=0&&v.splice(a,1),d&&u&&(d=!1,u=!1,f.imageEl&&(i.scale=Math.max(Math.min(i.scale,f.maxRatio),t.minRatio),f.imageEl.style.transitionDuration=`${o.params.speed}ms`,f.imageEl.style.transform=`translate3d(0,0,0) scale(${i.scale})`,p=i.scale,g=!1,i.scale>1&&f.slideEl?f.slideEl.classList.add(`${t.zoomedSlideClass}`):i.scale<=1&&f.slideEl&&f.slideEl.classList.remove(`${t.zoomedSlideClass}`),1===i.scale&&(f.originX=0,f.originY=0,f.slideEl=void 0)))}function $(){o.touchEventsData.preventTouchMoveFromPointerMove=!1}function T(e){const t="mouse"===e.pointerType&&o.params.zoom.panOnMouseMove;if(!C(e)||!W(e))return;const i=o.zoom;if(!f.imageEl)return;if(!x.isTouched||!f.slideEl)return void(t&&D(e));if(t)return void D(e);x.isMoved||(x.width=f.imageEl.offsetWidth||f.imageEl.clientWidth,x.height=f.imageEl.offsetHeight||f.imageEl.clientHeight,x.startX=r(f.imageWrapEl,"x")||0,x.startY=r(f.imageWrapEl,"y")||0,f.slideWidth=f.slideEl.offsetWidth,f.slideHeight=f.slideEl.offsetHeight,f.imageWrapEl.style.transitionDuration="0ms");const a=x.width*i.scale,s=x.height*i.scale;if(x.minX=Math.min(f.slideWidth/2-a/2,0),x.maxX=-x.minX,x.minY=Math.min(f.slideHeight/2-s/2,0),x.maxY=-x.minY,x.touchesCurrent.x=v.length>0?v[0].pageX:e.pageX,x.touchesCurrent.y=v.length>0?v[0].pageY:e.pageY,Math.max(Math.abs(x.touchesCurrent.x-x.touchesStart.x),Math.abs(x.touchesCurrent.y-x.touchesStart.y))>5&&(o.allowClick=!1),!x.isMoved&&!g){if(o.isHorizontal()&&(Math.floor(x.minX)===Math.floor(x.startX)&&x.touchesCurrent.x<x.touchesStart.x||Math.floor(x.maxX)===Math.floor(x.startX)&&x.touchesCurrent.x>x.touchesStart.x))return x.isTouched=!1,void $();if(!o.isHorizontal()&&(Math.floor(x.minY)===Math.floor(x.startY)&&x.touchesCurrent.y<x.touchesStart.y||Math.floor(x.maxY)===Math.floor(x.startY)&&x.touchesCurrent.y>x.touchesStart.y))return x.isTouched=!1,void $()}e.cancelable&&e.preventDefault(),e.stopPropagation(),clearTimeout(Y),o.touchEventsData.preventTouchMoveFromPointerMove=!0,Y=setTimeout((()=>{o.destroyed||$()})),x.isMoved=!0;const n=(i.scale-p)/(f.maxRatio-o.params.zoom.minRatio),{originX:l,originY:m}=f;x.currentX=x.touchesCurrent.x-x.touchesStart.x+x.startX+n*(x.width-2*l),x.currentY=x.touchesCurrent.y-x.touchesStart.y+x.startY+n*(x.height-2*m),x.currentX<x.minX&&(x.currentX=x.minX+1-(x.minX-x.currentX+1)**.8),x.currentX>x.maxX&&(x.currentX=x.maxX-1+(x.currentX-x.maxX+1)**.8),x.currentY<x.minY&&(x.currentY=x.minY+1-(x.minY-x.currentY+1)**.8),x.currentY>x.maxY&&(x.currentY=x.maxY-1+(x.currentY-x.maxY+1)**.8),X.prevPositionX||(X.prevPositionX=x.touchesCurrent.x),X.prevPositionY||(X.prevPositionY=x.touchesCurrent.y),X.prevTime||(X.prevTime=Date.now()),X.x=(x.touchesCurrent.x-X.prevPositionX)/(Date.now()-X.prevTime)/2,X.y=(x.touchesCurrent.y-X.prevPositionY)/(Date.now()-X.prevTime)/2,Math.abs(x.touchesCurrent.x-X.prevPositionX)<2&&(X.x=0),Math.abs(x.touchesCurrent.y-X.prevPositionY)<2&&(X.y=0),X.prevPositionX=x.touchesCurrent.x,X.prevPositionY=x.touchesCurrent.y,X.prevTime=Date.now(),f.imageWrapEl.style.transform=`translate3d(${x.currentX}px, ${x.currentY}px,0)`}function L(){const e=o.zoom;f.slideEl&&o.activeIndex!==o.slides.indexOf(f.slideEl)&&(f.imageEl&&(f.imageEl.style.transform="translate3d(0,0,0) scale(1)"),f.imageWrapEl&&(f.imageWrapEl.style.transform="translate3d(0,0,0)"),f.slideEl.classList.remove(`${o.params.zoom.zoomedSlideClass}`),e.scale=1,p=1,f.slideEl=void 0,f.imageEl=void 0,f.imageWrapEl=void 0,f.originX=0,f.originY=0)}function D(e){if(p<=1||!f.imageWrapEl)return;if(!C(e)||!W(e))return;const t=c.getComputedStyle(f.imageWrapEl).transform,i=new c.DOMMatrix(t);if(!h)return h=!0,E.x=e.clientX,E.y=e.clientY,x.startX=i.e,x.startY=i.f,x.width=f.imageEl.offsetWidth||f.imageEl.clientWidth,x.height=f.imageEl.offsetHeight||f.imageEl.clientHeight,f.slideWidth=f.slideEl.offsetWidth,void(f.slideHeight=f.slideEl.offsetHeight);const a=-3*(e.clientX-E.x),r=-3*(e.clientY-E.y),s=x.width*p,o=x.height*p,n=f.slideWidth,l=f.slideHeight,m=Math.min(n/2-s/2,0),d=-m,u=Math.min(l/2-o/2,0),g=-u,v=Math.max(Math.min(x.startX+a,d),m),X=Math.max(Math.min(x.startY+r,g),u);f.imageWrapEl.style.transitionDuration="0ms",f.imageWrapEl.style.transform=`translate3d(${v}px, ${X}px, 0)`,E.x=e.clientX,E.y=e.clientY,x.startX=v,x.startY=X,x.currentX=v,x.currentY=X}function H(e){const r=o.zoom,s=o.params.zoom;if(!f.slideEl){e&&e.target&&(f.slideEl=e.target.closest(`.${o.params.slideClass}, swiper-slide`)),f.slideEl||(o.params.virtual&&o.params.virtual.enabled&&o.virtual?f.slideEl=t(o.slidesEl,`.${o.params.slideActiveClass}`)[0]:f.slideEl=o.slides[o.activeIndex]);let a=f.slideEl.querySelector(`.${s.containerClass}`);a&&(a=a.querySelectorAll("picture, img, svg, canvas, .swiper-zoom-target")[0]),f.imageEl=a,f.imageWrapEl=a?i(f.imageEl,`.${s.containerClass}`)[0]:void 0}if(!f.imageEl||!f.imageWrapEl)return;let n,l,m,d,u,g,h,E,v,X,Y,y,M,C,W,w,S,b;o.params.cssMode&&(o.wrapperEl.style.overflow="hidden",o.wrapperEl.style.touchAction="none"),f.slideEl.classList.add(`${s.zoomedSlideClass}`),void 0===x.touchesStart.x&&e?(n=e.pageX,l=e.pageY):(n=x.touchesStart.x,l=x.touchesStart.y);const $=p,T="number"==typeof e?e:null;1===p&&T&&(n=void 0,l=void 0,x.touchesStart.x=void 0,x.touchesStart.y=void 0);const L=z();r.scale=T||L,p=T||L,!e||1===p&&T?(h=0,E=0):(S=f.slideEl.offsetWidth,b=f.slideEl.offsetHeight,m=a(f.slideEl).left+c.scrollX,d=a(f.slideEl).top+c.scrollY,u=m+S/2-n,g=d+b/2-l,v=f.imageEl.offsetWidth||f.imageEl.clientWidth,X=f.imageEl.offsetHeight||f.imageEl.clientHeight,Y=v*r.scale,y=X*r.scale,M=Math.min(S/2-Y/2,0),C=Math.min(b/2-y/2,0),W=-M,w=-C,$>0&&T&&"number"==typeof x.currentX&&"number"==typeof x.currentY?(h=x.currentX*r.scale/$,E=x.currentY*r.scale/$):(h=u*r.scale,E=g*r.scale),h<M&&(h=M),h>W&&(h=W),E<C&&(E=C),E>w&&(E=w)),T&&1===r.scale&&(f.originX=0,f.originY=0),x.currentX=h,x.currentY=E,f.imageWrapEl.style.transitionDuration="300ms",f.imageWrapEl.style.transform=`translate3d(${h}px, ${E}px,0)`,f.imageEl.style.transitionDuration="300ms",f.imageEl.style.transform=`translate3d(0,0,0) scale(${r.scale})`}function P(){const e=o.zoom,a=o.params.zoom;if(!f.slideEl){o.params.virtual&&o.params.virtual.enabled&&o.virtual?f.slideEl=t(o.slidesEl,`.${o.params.slideActiveClass}`)[0]:f.slideEl=o.slides[o.activeIndex];let e=f.slideEl.querySelector(`.${a.containerClass}`);e&&(e=e.querySelectorAll("picture, img, svg, canvas, .swiper-zoom-target")[0]),f.imageEl=e,f.imageWrapEl=e?i(f.imageEl,`.${a.containerClass}`)[0]:void 0}f.imageEl&&f.imageWrapEl&&(o.params.cssMode&&(o.wrapperEl.style.overflow="",o.wrapperEl.style.touchAction=""),e.scale=1,p=1,x.currentX=void 0,x.currentY=void 0,x.touchesStart.x=void 0,x.touchesStart.y=void 0,f.imageWrapEl.style.transitionDuration="300ms",f.imageWrapEl.style.transform="translate3d(0,0,0)",f.imageEl.style.transitionDuration="300ms",f.imageEl.style.transform="translate3d(0,0,0) scale(1)",f.slideEl.classList.remove(`${a.zoomedSlideClass}`),f.slideEl=void 0,f.originX=0,f.originY=0,o.params.zoom.panOnMouseMove&&(E={x:0,y:0},h&&(h=!1,x.startX=0,x.startY=0)))}function R(e){const t=o.zoom;t.scale&&1!==t.scale?P():H(e)}function I(){return{passiveListener:!!o.params.passiveListeners&&{passive:!0,capture:!1},activeListenerWithCapture:!o.params.passiveListeners||{passive:!1,capture:!0}}}function A(){const e=o.zoom;if(e.enabled)return;e.enabled=!0;const{passiveListener:t,activeListenerWithCapture:i}=I();o.wrapperEl.addEventListener("pointerdown",w,t),o.wrapperEl.addEventListener("pointermove",S,i),["pointerup","pointercancel","pointerout"].forEach((e=>{o.wrapperEl.addEventListener(e,b,t)})),o.wrapperEl.addEventListener("pointermove",T,i)}function O(){const e=o.zoom;if(!e.enabled)return;e.enabled=!1;const{passiveListener:t,activeListenerWithCapture:i}=I();o.wrapperEl.removeEventListener("pointerdown",w,t),o.wrapperEl.removeEventListener("pointermove",S,i),["pointerup","pointercancel","pointerout"].forEach((e=>{o.wrapperEl.removeEventListener(e,b,t)})),o.wrapperEl.removeEventListener("pointermove",T,i)}Object.defineProperty(o.zoom,"scale",{get:()=>y,set(e){if(y!==e){const t=f.imageEl,i=f.slideEl;m("zoomChange",e,t,i)}y=e}}),l("init",(()=>{o.params.zoom.enabled&&A()})),l("destroy",(()=>{O()})),l("touchStart",((e,t)=>{o.zoom.enabled&&function(e){const t=o.device;if(!f.imageEl)return;if(x.isTouched)return;t.android&&e.cancelable&&e.preventDefault(),x.isTouched=!0;const i=v.length>0?v[0]:e;x.touchesStart.x=i.pageX,x.touchesStart.y=i.pageY}(t)})),l("touchEnd",((e,t)=>{o.zoom.enabled&&function(){const e=o.zoom;if(v.length=0,!f.imageEl)return;if(!x.isTouched||!x.isMoved)return x.isTouched=!1,void(x.isMoved=!1);x.isTouched=!1,x.isMoved=!1;let t=300,i=300;const a=X.x*t,r=x.currentX+a,s=X.y*i,n=x.currentY+s;0!==X.x&&(t=Math.abs((r-x.currentX)/X.x)),0!==X.y&&(i=Math.abs((n-x.currentY)/X.y));const l=Math.max(t,i);x.currentX=r,x.currentY=n;const m=x.width*e.scale,c=x.height*e.scale;x.minX=Math.min(f.slideWidth/2-m/2,0),x.maxX=-x.minX,x.minY=Math.min(f.slideHeight/2-c/2,0),x.maxY=-x.minY,x.currentX=Math.max(Math.min(x.currentX,x.maxX),x.minX),x.currentY=Math.max(Math.min(x.currentY,x.maxY),x.minY),f.imageWrapEl.style.transitionDuration=`${l}ms`,f.imageWrapEl.style.transform=`translate3d(${x.currentX}px, ${x.currentY}px,0)`}()})),l("doubleTap",((e,t)=>{!o.animating&&o.params.zoom.enabled&&o.zoom.enabled&&o.params.zoom.toggle&&R(t)})),l("transitionEnd",(()=>{o.zoom.enabled&&o.params.zoom.enabled&&L()})),l("slideChange",(()=>{o.zoom.enabled&&o.params.zoom.enabled&&o.params.cssMode&&L()})),Object.assign(o.zoom,{enable:A,disable:O,in:H,out:P,toggle:R})}export{s as default};